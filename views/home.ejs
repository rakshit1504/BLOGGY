<%- include("partials/header"); -%>
<div class="container-fluid home-body home-body-bg">
    <main id="intro-content" class="container my-2">
        <h1>Welcome To <span id="postoblog">BLOGGY!</span>
        </h1>
        <% if(authenticated) { %>
        <h4>See what people are writing and <a href="/compose">compose</a> your own posts.</h4>
        <% } else { %>
        <h4>Discover what others have shared, and join the conversation <a href="/signin"> by signing in</a> to express
            your own experiences and insights.
        </h4>
        <% } %>
    </main>

    <div class="search-container">
        <form action="/search" method="GET" class="search-form">
            <input type="text" name="query" class="search-input" placeholder="Search posts..." required>
            <button type="submit" class="search-button">Search</button>
        </form>
    </div>


    <div class="container main-content-area">
        <div class="row">
            <!-- Your Posts Column -->
            <div class="col-md-8">
                <h2 class="column-title"><%= pageTitle %></h2>
                
                <% if (newPost.length === 0) { %>
                    <div class="text-center">
                        <p>No posts found.</p>
                    </div>
                <% } %>
            
                <% newPost.forEach(function(post){ %>
                <div class="card post-box">
                    <div class="card-body">
                        <h2 class="card-title post-title"> <a class="post-title" href="/posts/<%=post._id%> "><%= post.title %></a>
                        </h2>
                        <h6 class="card-subtitle mb-2"> <a href="/profile/<%=post.authorId%> "> <em><%= "@" + post.account
                                    %></em> </a></h6>
                        <p class="card-text post-para"><%- post.sanitizedHtml.substring(0, 200) %>...</p>
                        <a class="btn rm-btn" href="/posts/<%=post._id%> " role="button">Read more</a>
                        <% if(authenticated) { %>
                        <form class="like-btn" action="/like" method="post">
                            <% if(userLikedPosts.includes(post._id)) { %>
                            <input type="hidden" name="postId" value="<%=post._id%>">
                            <button class='btn btn-xs' type="submit" name="liked" value='false'><i class="fa fa-thumbs-up liked"></i>
                                Liked</button><span>
                                <%=post.likes%> people like this.
                            </span>
                            <% } else { %>
                            <input type="hidden" name="postId" value="<%=post._id%>">
                            <button class='btn btn-xs' type="submit" name="liked" value='true'><i class="fas fa-thumbs-up"></i>
                                Like</button> <span>
                                <%= post.likes%> people liked this.
                            </span>
                            <% } %>
                        </form>
                        <% } else { %>
                        <br><span>
                            <%= post.likes%> people liked this.
                        </span>
                        <% } %>
                    </div>
                </div>
                <% }) %>
            </div>

            <!-- Trending Posts Column -->
            <div class="col-md-4">
                <h2 class="column-title">Trending in Tech</h2>
                <% if (trendingArticles && trendingArticles.length > 0) { %>
                    <div class="trending-articles">
                        <% trendingArticles.forEach(function(article){ %>
                            <a href="<%= article.url %>" target="_blank" rel="noopener noreferrer" class="trending-card-link">
                                <div class="trending-card">
                                    <% if (article.cover_image) { %>
                                        <img src="<%= article.cover_image %>" alt="Cover image for <%= article.title %>" class="trending-card-img">
                                    <% } %>
                                    <div class="trending-card-body">
                                        <h4 class="trending-card-title"><%= article.title %></h4>
                                        <p class="trending-card-author">by <%= article.user.name %></p>
                                    </div>
                                </div>
                            </a>
                        <% }) %>
                    </div>
                <% } else { %>
                    <p>Could not load trending articles at this time.</p>
                <% } %>
            </div>
        </div>
    </div>
</div>

<%- include("partials/footer"); -%>